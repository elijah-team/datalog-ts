# basically getting everything but text
astInternal.ruleTreeNode{id: ID, parentID: PID, seq: Seq, display: D} :-
  astInternal.ruleTreeNodeCur{id: ID, parentID: PID, seq: Seq, display: D} |
  astInternal.ruleTreeNodeBefore{id: ID, parentID: PID, seq: Seq, display: D} |
  astInternal.ruleTreeNodeAfter{id: ID, parentID: PID, seq: Seq, display: D}.

astInternal.ruleTreeNodeBefore{
  id: ID,
  parentID: PID,
  display: [R, [F, T]],
  seq: Seq
} :-
  astInternal.node{id: ID, parentID: PID, idx: Seq, rule: R, span: span{from: F, to: T}} &
  ide.Cursor{idx: Idx} &
  Idx > T.

astInternal.ruleTreeNodeAfter{
  id: ID,
  parentID: PID,
  display: [R, [F, T]],
  seq: Seq
} :-
  astInternal.node{id: ID, parentID: PID, idx: Seq, rule: R, span: span{from: F, to: T}} &
  ide.Cursor{idx: Idx} &
  Idx < F.

astInternal.ruleTreeNodeCur{
  id: ID,
  parentID: PID,
  display: ["*", R, [F, T]],
  seq: Seq
} :-
  astInternal.node{id: ID, parentID: PID, idx: Seq, rule: R, span: span{from: F, to: T}} &
  ide.Cursor{idx: Idx} &
  F <= Idx & Idx <= T.

internal.visualization{
  name: "Rule Tree",
  spec: tree{
    nodes: "astInternal.ruleTreeNode{id: ID, parentID: ParentID, display: Display, seq: Seq}",
    rootTerm: -1
  }
}.
